package exit.services.util;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

import exit.services.fileHandler.ConstantesGenerales;

public class ManejadorDateAPI {
	
	private static ManejadorDateAPI instance;
	private String fechaGuardada;
	private Date fechaHasta;
	private String fechaDesdeSales;
	private String fechaHastaService;
	private File f= new File(ConstantesGenerales.PATH_HORA_ULTIMA_EJECUCION);
	private SimpleDateFormat dateFormatEnArchivo=new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
	
	private ManejadorDateAPI(){
		String line;
		try(BufferedReader br = new BufferedReader(new FileReader(f)) ) {			
			if( (line=br.readLine())!=null){
				try {
					this.fechaGuardada= line;
					fechaHasta = new Date();
					initFechaDesdeSales(line);
					initFechaHastaSales();
				} catch (ParseException e) {
					e.printStackTrace();
				}
			}
		} catch (IOException e) {
			e.printStackTrace();
		}

	}
	
	public synchronized static ManejadorDateAPI getInstance(){
		if(null == instance){
			instance = new ManejadorDateAPI();
		}
		return instance;
	}

	public String getFechaDesdeSales() {
		return fechaDesdeSales;
	}

	public void setFechaDesdeSales(String fechaDesde) {
		this.fechaDesdeSales = fechaDesde;
	}

	public String getFechaHastaSales() {
		return fechaHastaService;
	}
	
	public void saveNewDate(){
		String line;
		try(FileWriter fw= new FileWriter(f,false)) {			
			fw.write(getFechaHastaSales());
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	private void initFechaHastaSales() {
		DateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
		DateFormat dateFormat2 = new SimpleDateFormat("hh:mm:ss");
		this.fechaHastaService=dateFormat.format(date)+"T"+dateFormat2.format(date)+"%2B00:00";
	}
	
	private void initFechaDesdeSales(String line){
		Date date;
		try {
			date = dateFormatEnArchivo.parse(line);
			DateFormat dateFormat2 = new SimpleDateFormat("yyyy-MM-dd");
			DateFormat dateFormat3 = new SimpleDateFormat("hh:mm:ss");
			this.fechaDesdeSales=dateFormat2.format(date)+"T"+dateFormat3.format(date)+"%2B00:00";
		} catch (ParseException e) {
			e.printStackTrace();
		}
	}
	
	public static void main(String[] args){
		System.out.println(ManejadorDateAPI.getInstance().getFechaDesdeSales());
	}
	
	
	
	
}
